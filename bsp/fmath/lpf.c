#include "lpf.h"

struct lpf_thr_type
{
	float a1, a2, a3, a4;
	float	b1, b2, b3, b4;
	float x1, x2, x3, x4;
};

static struct lpf_thr_type lpf_thrs[lpf_thr_cnt] = 
{
	{ 1.000000e+00, -2.874357e+00, 2.756483e+00, -8.818931e-01, 2.914649e-05, 8.743948e-05, 8.743948e-05, 2.914649e-05 },     //	10hz/1000	acc
	{ 1.000000e+00, -2.874357e+00, 2.756483e+00, -8.818931e-01, 2.914649e-05, 8.743948e-05, 8.743948e-05, 2.914649e-05 },
	{ 1.000000e+00, -2.874357e+00, 2.756483e+00, -8.818931e-01, 2.914649e-05, 8.743948e-05, 8.743948e-05, 2.914649e-05 },
//	{ 1.000000e+00, -1.760042e+00, 1.182893e+00, -2.780599e-01, 1.809893e-02, 5.429680e-02, 5.429680e-02, 1.809893e-02 },   // 100hz/1000 dgy_tar
//	{ 1.000000e+00, -1.760042e+00, 1.182893e+00, -2.780599e-01, 1.809893e-02, 5.429680e-02, 5.429680e-02, 1.809893e-02 },
//	{ 1.000000e+00, -1.760042e+00, 1.182893e+00, -2.780599e-01, 1.809893e-02, 5.429680e-02, 5.429680e-02, 1.809893e-02 },
	
#ifdef MOTOR
	{ 1.000000e+00, -2.787587e+00, 2.613371e+00, -8.231234e-01, 5.908214e-03, -4.578017e-03, -4.578017e-03, 5.908214e-03 },		//	25hz/1000	gyr elliptic 40 0.5
	{ 1.000000e+00, -2.787587e+00, 2.613371e+00, -8.231234e-01, 5.908214e-03, -4.578017e-03, -4.578017e-03, 5.908214e-03 },
	{ 1.000000e+00, -2.787587e+00, 2.613371e+00, -8.231234e-01, 5.908214e-03, -4.578017e-03, -4.578017e-03, 5.908214e-03 },
	
	{ 1.000000e+00, -2.894956e+00, 2.798101e+00, -9.028716e-01, 4.368373e-04, -3.002947e-04, -3.002947e-04, 4.368373e-04 },		//	10hz/1000	dgy elliptic 65 0.2
	{ 1.000000e+00, -2.894956e+00, 2.798101e+00, -9.028716e-01, 4.368373e-04, -3.002947e-04, -3.002947e-04, 4.368373e-04 },
	{ 1.000000e+00, -2.894956e+00, 2.798101e+00, -9.028716e-01, 4.368373e-04, -3.002947e-04, -3.002947e-04, 4.368373e-04 },
#endif

#ifdef ENGINE
//	{ 1.000000e+00, -2.787587e+00, 2.613371e+00, -8.231234e-01, 5.908214e-03, -4.578017e-03, -4.578017e-03, 5.908214e-03 },		//	25hz/1000	gyr elliptic 40 0.5
//	{ 1.000000e+00, -2.787587e+00, 2.613371e+00, -8.231234e-01, 5.908214e-03, -4.578017e-03, -4.578017e-03, 5.908214e-03 },
//	{ 1.000000e+00, -2.787587e+00, 2.613371e+00, -8.231234e-01, 5.908214e-03, -4.578017e-03, -4.578017e-03, 5.908214e-03 },
//	
//	{ 1.000000e+00, -2.938404e+00, 2.879398e+00, -9.409443e-01, 7.929309e-05, -5.462180e-05, -5.462180e-05, 7.929309e-05 },		//	 5hz/1000	dgy elliptic 80 0.1
//	{ 1.000000e+00, -2.938404e+00, 2.879398e+00, -9.409443e-01, 7.929309e-05, -5.462180e-05, -5.462180e-05, 7.929309e-05 },
//	{ 1.000000e+00, -2.938404e+00, 2.879398e+00, -9.409443e-01, 7.929309e-05, -5.462180e-05, -5.462180e-05, 7.929309e-05 },
	
	
//	{ 1.000000e+00, -2.832333e+00, 2.689066e+00, -8.553685e-01, 3.271596e-03, -2.589434e-03, -2.589434e-03, 3.271596e-03 },		//	20hz/1000	gyr elliptic 45 0.5
//	{ 1.000000e+00, -2.832333e+00, 2.689066e+00, -8.553685e-01, 3.271596e-03, -2.589434e-03, -2.589434e-03, 3.271596e-03 },
//	{ 1.000000e+00, -2.832333e+00, 2.689066e+00, -8.553685e-01, 3.271596e-03, -2.589434e-03, -2.589434e-03, 3.271596e-03 },
//	
//	{ 1.000000e+00, -2.953470e+00, 2.908732e+00, -9.552335e-01, 5.399132e-05, -3.980100e-05, -3.980100e-05, 5.399132e-05 },		//	 5hz/1000	dgy elliptic 82.5 0.3
//	{ 1.000000e+00, -2.953470e+00, 2.908732e+00, -9.552335e-01, 5.399132e-05, -3.980100e-05, -3.980100e-05, 5.399132e-05 },
//	{ 1.000000e+00, -2.953470e+00, 2.908732e+00, -9.552335e-01, 5.399132e-05, -3.980100e-05, -3.980100e-05, 5.399132e-05 },
	
	
	{ 1.000000e+00, -2.876064e+00, 2.765831e+00, -8.891872e-01, 1.689284e-03, -1.399400e-03, -1.399400e-03, 1.689284e-03 },		//	15hz/1000	gyr elliptic 50 0.5
	{ 1.000000e+00, -2.876064e+00, 2.765831e+00, -8.891872e-01, 1.689284e-03, -1.399400e-03, -1.399400e-03, 1.689284e-03 },
	{ 1.000000e+00, -2.876064e+00, 2.765831e+00, -8.891872e-01, 1.689284e-03, -1.399400e-03, -1.399400e-03, 1.689284e-03 },
	
	{ 1.000000e+00, -2.968228e+00, 2.937682e+00, -9.694390e-01, 3.572882e-05, -2.821213e-05, -2.821213e-05, 3.572882e-05 },		//	 5hz/1000	dgy elliptic 85 1.0
	{ 1.000000e+00, -2.968228e+00, 2.937682e+00, -9.694390e-01, 3.572882e-05, -2.821213e-05, -2.821213e-05, 3.572882e-05 },
	{ 1.000000e+00, -2.968228e+00, 2.937682e+00, -9.694390e-01, 3.572882e-05, -2.821213e-05, -2.821213e-05, 3.572882e-05 },
#endif
	
	{ 1.000000e+00, -1.760042e+00, 1.182893e+00, -2.780599e-01, 1.809893e-02, 5.429680e-02, 5.429680e-02, 1.809893e-02 },   // 100hz/1000 dgy_tar
	{ 1.000000e+00, -1.760042e+00, 1.182893e+00, -2.780599e-01, 1.809893e-02, 5.429680e-02, 5.429680e-02, 1.809893e-02 },
	{ 1.000000e+00, -1.760042e+00, 1.182893e+00, -2.780599e-01, 1.809893e-02, 5.429680e-02, 5.429680e-02, 1.809893e-02 },
	
	{ 1.000000e+00, -2.874357e+00, 2.756483e+00, -8.818931e-01, 2.914649e-05, 8.743948e-05, 8.743948e-05, 2.914649e-05 },		//	10hz/1000	mag
	{ 1.000000e+00, -2.874357e+00, 2.756483e+00, -8.818931e-01, 2.914649e-05, 8.743948e-05, 8.743948e-05, 2.914649e-05 },
	{ 1.000000e+00, -2.874357e+00, 2.756483e+00, -8.818931e-01, 2.914649e-05, 8.743948e-05, 8.743948e-05, 2.914649e-05 },
	
	{ 1.000000e+00, -1.760042e+00, 1.182893e+00, -2.780599e-01, 1.809893e-02, 5.429680e-02, 5.429680e-02, 1.809893e-02 },   // 100hz/1000 ang_tar
	{ 1.000000e+00, -1.760042e+00, 1.182893e+00, -2.780599e-01, 1.809893e-02, 5.429680e-02, 5.429680e-02, 1.809893e-02 },
	{ 1.000000e+00, -1.760042e+00, 1.182893e+00, -2.780599e-01, 1.809893e-02, 5.429680e-02, 5.429680e-02, 1.809893e-02 },

	{ 1.000000e+00, -2.937171e+00, 2.876300e+00, -9.390989e-01, 3.756838e-06, 1.127051e-05, 1.127051e-05, 3.756838e-06 },   //   5hz/1000 bus
	{ 1.000000e+00, -2.937171e+00, 2.876300e+00, -9.390989e-01, 3.756838e-06, 1.127051e-05, 1.127051e-05, 3.756838e-06 },
	{ 1.000000e+00, -2.937171e+00, 2.876300e+00, -9.390989e-01, 3.756838e-06, 1.127051e-05, 1.127051e-05, 3.756838e-06 },
	{ 1.000000e+00, -2.937171e+00, 2.876300e+00, -9.390989e-01, 3.756838e-06, 1.127051e-05, 1.127051e-05, 3.756838e-06 },
};

float lpf_calc(uint8_t mask, float v)
{
	struct lpf_thr_type * l = &lpf_thrs[mask];
	l->x1 =         v*l->a1 - l->x2*l->a2 - l->x3*l->a3 - l->x4*l->a4;
	float res = l->x1*l->b1 + l->x2*l->b2 + l->x3*l->b3 + l->x4*l->b4;
	l->x4 = l->x3;
	l->x3 = l->x2;
	l->x2 = l->x1;
	return res;
}


